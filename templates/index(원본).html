<!DOCTYPE html>
<html lang="ko">

<head>
    <meta property="og:title" content="ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„" />
    <meta property="og:description" content="ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ì˜í™”ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”" />
    <meta property="og:image" content="https://i.ytimg.com/vi/hAO9a1xSo3M/maxresdefault.jpg" />

    <!-- ë‹¤ì–‘í•œ ì–¸ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ UTF-8 ì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. -->
    <meta charset="UTF-8" />

    <!-- ë°˜ì‘í˜•ìœ¼ë¡œ ë™ì‘í•˜ê²Œ í•©ë‹ˆë‹¤. -->
    <meta title="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap ì„ í¬í•¨í•©ë‹ˆë‹¤. -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">

    <!-- jQuery ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- CSS library ì¸ Bulma ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css" />

    <!-- í…ìŠ¤íŠ¸í˜•íƒœë¡œ ë˜ì–´ìˆëŠ” icon ì„ ì“¸ ìˆ˜ ìˆë„ë¡ Font awesome ì„ í¬í•¨í•˜ë¹ˆë‹¤. -->
    <script defer src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"></script>

    <title>
        ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ | ì¢‹ì•„í•˜ëŠ” ì˜í™” ì¶”ì²œ ì‚¬ì´íŠ¸
    </title>

    <link href="https://fonts.googleapis.com/css2?family=Orbit&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Orbit', sans-serif;
        }

        .center {
            text-align: center;
        }

        .sorter-box {
            width: 600px;
            /* background-color: green; */
        }

        .my-link {
            /* background-color: green; */
            text-align: right;

            margin-bottom: 15px;
        }

        .my-link-btn {
            color: rgb(61, 218, 61);
        }

        .movie-list {
            width: 600px;
            /* background-color: green; */
            margin: 20px auto 0 auto;
        }

        .movie-title {
            display: inline-block;
            font-size: x-large;
            font-weight: bold;
        }

        .movie-title:hover {
            text-decoration: underline;
        }

        .movie-poster {
            width: 110px;
            height: 145px;
            float: left;
        }

        .card-in-data {
            /* background-color: green; */
            margin-bottom: 13px;
            margin-left: 130px;
        }

        .btn-btn {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;

            text-align: center;

            position: absolute;
            bottom: 10px;
        }

        .movie-button1 {
            width: 280px;
            height: 55px;
            /* background-color: yellow; */
            border-top: 1px solid rgb(187, 184, 184);
            border-right: 1px solid rgb(187, 184, 184);
            color: blue;

            
            padding-top: 15px;
            margin-top: 10px;
        }

        .movie-button2 {
            width: 280px;
            height: 55px;
            /* background-color: aqua; */
            border-top: 1px solid rgb(187, 184, 184);
            color: red;

            padding-top: 15px;
            margin-top: 10px;
        }

        .movie-button3 {
            width: 280px;
            height: 55px;
            /* background-color: yellow; */
            border-top: 1px solid rgb(187, 184, 184);
            border-right: 1px solid rgb(187, 184, 184);
            color: blue;

            
            padding-top: 15px;
            margin-top: 10px;
        }

        .movie-button4 {
            width: 280px;
            height: 55px;
            /* background-color: aqua; */
            border-top: 1px solid rgb(187, 184, 184);
            color: red;

            padding-top: 15px;
            margin-top: 10px;
        }

        .my-cards {
            /* background-color: green; */
            width: 600px;
            height: 270px;
            padding: 20px;
            border: 1px solid rgb(187, 184, 184);
            border-radius: 5px;
            margin-bottom: 10px;
            margin-top: 15px;

            position: relative;
        }
    </style>
    <!-- ì´ HTML ì—ì„œ ì‚¬ìš©í•  JavaScript ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. -->
    <script>
        const Sort = {
            BY_LIKES: "likes",
            BY_VIEWERS: "viewers",
            BY_DATE: "date",
        };

        let sortMode = Sort.BY_LIKES
        let trashMode = false

        // index.html ì˜ ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ready(...) ì•ˆì— ë“±ë¡ëœ í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
        // ì•„ë˜ëŠ” í•¨ìˆ˜ì— ì´ë¦„ì„ ë¶€ì—¬í•˜ì§€ ì•Šê³  ë°”ë¡œ ready(...) ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¡œë“œ ì™„ë£Œì‹œ í˜¸ì¶œë  í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
        $(document).ready(function () {
            // ì˜í™” ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            ajax_get12()

            // í˜„ì¬ ì ìš©ë˜ê³  ìˆëŠ” ì •ë ¬ ë°©ì‹ì˜ ë²„íŠ¼ì— ëˆŒë ¤ì ¸ ë³´ì´ëŠ” íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤.
            displaySorter()
        });

        function ajax_get12() {
            // 1. id="movie-box" ë¡œ ëœ íƒœê·¸ì˜ ë‚´ë¶€ html íƒœê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.
            $('#movie-box').empty()

            // 2. íœ´ì§€í†µì„ ë³´ê³  ìˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ í˜¸ì¶œí•  API ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
            //    íœ´ì§€í†µì´ ì•„ë‹ ê²½ìš° GET /api/list
            //    íœ´ì§€í†µì¼ ê²½ìš° GET /api/list/trash
            if (trashMode == false) {
                // alert('trashModeê°€ falseìš”')
                $.ajax({
                    type: "GET",
                    url: "/get/1",
                    data: { 'sortMode': sortMode },
                    success: function (response) {
                        if (response['result'] != 'success') {
                            alert(sortMode + ' ìˆœìœ¼ë¡œ ì˜í™” ëª©ë¡ ë°›ì•„ì˜¤ê¸° ì‹¤íŒ¨!')
                            return
                        }
                        // 3. ì„œë²„ê°€ ëŒë ¤ì¤€ stars_listë¥¼ movies ë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
                        let movies = response['movies_list']
                        // 4. ì˜í™” ì¹´ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë•Œ íœ´ì§€í†µ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œ ëª¨ì–‘ì´ ë‹¬ë¼ì§€ë¯€ë¡œ íœ´ì§€í†µ ì—¬ë¶€(=false)ë„ ê°™ì´ ì „ë‹¬í•©ë‹ˆë‹¤.
                        addMovieCards(movies, false)
                    },
                })
            } 
            else {
                // alert('trashModeê°€ trueìš”')
                $.ajax({
                    type: "GET",
                    url: "/get/2",
                    data: { 'sortMode': sortMode },
                    success: function (response) {
                        if (response['result'] != 'success') {
                            alert(sortMode + ' ìˆœìœ¼ë¡œ ì˜í™” ëª©ë¡ ë°›ì•„ì˜¤ê¸° ì‹¤íŒ¨!')
                            return
                        }
                        // 3. ì„œë²„ê°€ ëŒë ¤ì¤€ stars_listë¥¼ movies ë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
                        let movies = response['movies_list']
                        // 4. ì˜í™” ì¹´ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë•Œ íœ´ì§€í†µ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œ ëª¨ì–‘ì´ ë‹¬ë¼ì§€ë¯€ë¡œ íœ´ì§€í†µ ì—¬ë¶€(=false)ë„ ê°™ì´ ì „ë‹¬í•©ë‹ˆë‹¤.
                        addMovieCards(movies, true)
                    },
                })
            }
        }

        function addMovieCards(movies, trashMode) {
            // for ë¬¸ì„ í™œìš©í•˜ì—¬ movies ë°°ì—´ì˜ ìš”ì†Œë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
            for (let i = 0; i < movies.length; i++) {
                let movie = movies[i]

                // 1. movie[i] ìš”ì†Œì˜ title,viewers, likes í‚¤ ê°’ì„ í™œìš©í•˜ì—¬ ê°’ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
                let id = movie['_id']

                let pos_url = movie['poster_url']

                let title = movie['title']

                let viewers = movie['viewers']
                viewers = viewers.toLocaleString();
                
                let likes = movie['likes']

                let year = movie['open_year']
                let month = movie['open_month']
                month = ('0' + month).slice(-2);
                let day = movie['open_day']
                day = ('0' + day).slice(-2);

                let info_url = movie['info_url']

                // 2. ì˜í™” ì¹´ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤.
                let cardContentHtml = `
                    <img src="${pos_url}" class="movie-poster" />
                    <div class="card-in-data">
                        <a style="color: black;" href="${info_url}" target="_blank"><span class="movie-title">${title}</span></a>
                        <p><span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes"> ${likes}</span></p>
                        <p>ëˆ„ì ê´€ê°ìˆ˜ <span class="movie-viewers">${viewers}</span> ëª…</p>
                        <p>ê°œë´‰ì¼ <span class="movie-date">${year}.${month}.${day}</span></p>
                    </div>
                `

                // 3. íœ´ì§€í†µì„ ë³´ê³  ìˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œì˜ ë²„íŠ¼ì„ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
                let cardFooterHtml = ''
                if (trashMode == false) {
                    cardFooterHtml = `
                        <div class="btn-btn">
                            <a class="movie-button1" type="button" href="#" onclick="ajax_post('${title}')">
                                ìœ„ë¡œ! <i class="fas fa-thumbs-up"></i>
                            </a>
                            <a class="movie-button2" type="button" href="#" onclick="ajax_post2('${title}')">
                                íœ´ì§€í†µìœ¼ë¡œ <i class="fa-solid fa-trash"></i>
                            </a>
                        </div>
                    `
                    // 4. #movie-boxì— ìƒì„±ëœ HTML ì„ ë¶™ì…ë‹ˆë‹¤.
                    $('#movie-box').append(`
                        <div class="my-cards">
                            ${cardContentHtml}
                            ${cardFooterHtml}
                        </div>
                    `)
                } else {
                    cardFooterHtml = `
                        <div class="btn-btn">
                            <a class="movie-button3" href="#" onclick="ajax_post3('${title}')">
                                ë³µêµ¬í•˜ê¸° <i class="fa-solid fa-trash-can-arrow-up"></i>
                            </a>
                            <a class="movie-button4" href="#" onclick="ajax_post4('${title}')">
                                ì˜êµ¬ì‚­ì œ <i class="fa-solid fa-ban"></i>
                            </a>
                        </div>
                    `
                    $('#movie-box').append(`
                        <div class="my-cards">
                            ${cardContentHtml}
                            ${cardFooterHtml}
                        </div>
                    `)
                }
            }
        }

        ///////////////////////////////////////////////////////////////////////////////
        // ì£¼ì˜: ì•„ë˜ like movie ëŠ” ì„ì˜ì˜ ì˜í™”ì— ì¢‹ì•„ìš”ê°€ í‘œì‹œë©ë‹ˆë‹¤.
        // ì´ êµ¬í˜„ì„ ì„ íƒí•œ ë¬´ë¹„ì— ì¢‹ì•„ìš”ë¥¼ ë„£ëŠ” ê²ƒìœ¼ë¡œ ìˆ˜ì •í•˜ì…”ì•¼ ë©ë‹ˆë‹¤. (í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ ë° í•¨ìˆ˜ êµ¬í˜„ ëª¨ë‘)
        function ajax_post(title) {
            $.ajax({
                type: "POST",
                url: "/post/1",
                data: { give : title },
                success: function (response) {
                    if (response['result'] == 'success') {
                        // 2. 'ì¢‹ì•„ìš” ì™„ë£Œ!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                        alert('ì¢‹ì•„ìš” ì™„ë£Œ!')
                        // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                        ajax_get12()
                        // window.location.reload();
                    } else {
                        alert('ì¢‹ì•„ìš” ì‹¤íŒ¨ã… ã… ')
                    }
                }
            });
        }

        function ajax_post2(title) {
            // alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.')
            $.ajax({
                type: "POST",
                url: "/post/2",
                data: { give : title },
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ì™„ë£Œ!')
                        ajax_get12()
                        // window.location.reload();
                    } else {
                        alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ì‹¤íŒ¨ã… ã… ')
                    }
                }
            });
        }

        function ajax_post3(title) {
            // alert('íœ´ì§€í†µì—ì„œ ë˜ì‚´ë¦¬ê¸° ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.')
            $.ajax({
                type: "POST",
                url: "/post/3",
                data: { give : title },
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert('íœ´ì§€í†µì—ì„œ ë³µêµ¬ ì™„ë£Œ!')
                        ajax_get12()
                        // window.location.reload();
                    } else {
                        alert('íœ´ì§€í†µì—ì„œ ë³µêµ¬ ì‹¤íŒ¨ã… ã… ')
                    }
                }
            });
        }

        function ajax_post4(title) {
            // alert('íœ´ì§€í†µì—ì„œ ì•„ì£¼ ì‚­ì œ ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.')
            $.ajax({
                type: "POST",
                url: "/post/4",
                data: { give : title },
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert('ì‚­ì œ ì™„ë£Œ! ì•ˆë…•!')
                        ajax_get12()
                        // window.location.reload();
                    } else {
                        alert('ì‚­ì œ ì‹¤íŒ¨ã… ã… ')
                    }
                }
            });
        }

        // ì •ë ¬ ê¸°ì¤€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜¸ì¶œë¨
        function changeSorter(newMode) {
            if (sortMode == newMode) {
                return
            }

            sortMode = newMode
            displaySorter()
            ajax_get12()
        }

        // ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼ í•´ë‹¹ ë²„íŠ¼ë§Œ í™œì„±í™” ì‹œí‚¤ê³  ë‹¤ë¥¸ ë²„íŠ¼ì€ ë¹„í™œì„±í™” ì‹œí‚´
        function displaySorter() {
            if (sortMode == 'likes') {
                document.getElementById("sorter-likes").classList.add("active")
                document.getElementById("sorter-viewers").classList.remove("active")
                document.getElementById("sorter-date").classList.remove("active")
            }
            else if (sortMode == 'viewers') {
                document.getElementById("sorter-likes").classList.remove("active")
                document.getElementById("sorter-viewers").classList.add("active")
                document.getElementById("sorter-date").classList.remove("active")
            }
            else {
                document.getElementById("sorter-likes").classList.remove("active")
                document.getElementById("sorter-viewers").classList.remove("active")
                document.getElementById("sorter-date").classList.add("active")
            }
        }

        function displayTrashMode() {
                // trashMode ì— ë”°ë¼ "íœ´ì§€í†µ ë³´ê¸°" ë˜ëŠ” "íœ´ì§€í†µ ë‚˜ê°€ê¸°" ê°€ ì¶œë ¥ ë˜ê²Œ êµ¬í˜„í•´ì•¼ ë©ë‹ˆë‹¤.
                if (trashMode == false) {
                    // console.log('falseì„')
                    trashMode = true
                    ajax_get12()
                    $('#btn-trash').html('<a onclick="displayTrashMode()" id="trash-mode-box" class="my-link-btn"><i class="fa-solid fa-trash-can-arrow-up"></i> <span>íœ´ì§€í†µ ë‚˜ê°€ê¸°</span></a>')
                }
                else {
                    // console.log('trueì„')
                    trashMode = false
                    ajax_get12()
                    $('#btn-trash').html('<a onclick="displayTrashMode()" id="trash-mode-box" class="my-link-btn"><i class="fa-solid fa-trash"></i> <span>íœ´ì§€í†µ ë³´ê¸°</span></a>')
                }
                
            }


    </script>
</head>

<!-- HTML ë³¸ë¬¸ì— í•´ë‹¹í•©ë‹ˆë‹¤. -->
<!-- HTML íƒœê·¸ë¥¼ ì´ìš©í•´ì„œ layout ì„ ëŒ€ëµì ìœ¼ë¡œ ì¡ì•„ë‘ê³ , -->
<!-- ìœ„ì— ì •ì˜ëœ JavaScript ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°ì‘í•´ ìµœì¢… HTML ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. -->

<body>
    <!-- ì œëª© ë¶€ë¶„ -->
    <section class="hero is-warning">
        <div class="hero-body">
            <div class="container center">
                <h1 class="title">
                    ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ğŸ˜†
                </h1>
                <h2 class="subtitle">
                    ìˆœìœ„ë¥¼ ë§¤ê²¨ë´…ì‹œë‹¤
                </h2>
            </div>
        </div>
    </section>

    <!-- ì •ë ¬ ì˜µì…˜ ë¶€ë¶„ -->
    <!-- *ì£¼ì˜* ì•„ë˜ ë‚´ìš© ì¤‘ id="sorter-likes", id="sorter-viewers", id="sorter-date" ì€ ì‚­ì œí•˜ë©´ ì•ˆë©ë‹ˆë‹¤. -->
    <div class="mx-auto sorter-box">
        <div class="btn-group m-3 mx-auto w-100">
            <a href="#" class="btn btn-primary" id="sorter-likes" onclick="changeSorter('likes')">ì¢‹ì•„ìš” ìˆœìœ¼ë¡œ ì •ë ¬</a>
            <a href="#" class="btn btn-primary" id="sorter-viewers" onclick="changeSorter('viewers')">ëˆ„ì ê´€ê°ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬</a>
            <a href="#" class="btn btn-primary" id="sorter-date" onclick="changeSorter('date')">ê°œë´‰ì¼ ìˆœìœ¼ë¡œ ì •ë ¬</a>
        </div>
        <div class="my-link"  id="btn-trash">
            <a onclick="displayTrashMode()" id="trash-mode-box" class="my-link-btn"><i class="fa-solid fa-trash"></i> <span>íœ´ì§€í†µ ë³´ê¸°</span></a>
        </div>
    </div>

    <!-- "íœ´ì§€í†µ ë³´ê¸°" ë¶€ë¶„ -->
    <!-- ë™ì ìœ¼ë¡œ ì˜í™” ëª©ë¡ì´ ë“¤ì–´ê°ˆ ë¶€ë¶„ -->
    <!-- *ì£¼ì˜* ì•„ë˜ ë‚´ìš© ì¤‘ id="movie-box" ì€ ì‚­ì œí•˜ë©´ ì•ˆë©ë‹ˆë‹¤. -->
    <div class="movie-list" id="movie-box">
        <!-- javascript ê°€ ì´ ì‚¬ì´ì— HTML element ë¥¼ ìƒì„±í•´ì„œ ì‚½ì…í•©ë‹ˆë‹¤. -->

    </div>
</body>

</html>